function getPointInRhombus(a,b){var c,d,e,f;var g,h,i,j,k,l;var m,n;c=parseInt(a/half_tile_width);d=parseInt(b/tile_height_offset);i=a%half_tile_width;j=b%tile_height_offset;if(i+j<half_tile_width+tile_height_offset){}g=c*half_tile_width;h=d*tile_height_offset;if((c+d)%2!=0){m=g+half_tile_width;n=h+tile_height_offset}else{h=h+tile_height_offset;m=g+half_tile_width;n=h-tile_height_offset}var o,p;o=Math.abs(g-a)+Math.abs(h-b);p=Math.abs(m-a)+Math.abs(n-b);if(o<p){a=g;b=h}else{a=m;b=n}return parseInt(pos2loc(a,b))}function pos2loc(a,b){var c,d;c=(2*b+a-itemStartX-half_tile_width)/(half_tile_width*2);d=(b-tile_height_offset-tile_height_offset*c)/tile_height_offset;if(c<0||d<0||c>=map_arr_width||d>=map_arr_height){return-1}return d*map_arr_width+c}function pos2loc_test(a,b){var c,d;c=(2*b+a-half_bg_width-half_tile_width)/(half_tile_width*2);d=(b-tile_height_offset-tile_height_offset*c)/tile_height_offset;alert(c+":"+d)}function loc2pos(a){var b,c;var d,e;e=parseInt(a/map_arr_width);d=a%map_arr_width;if(d==map_arr_width-1){d=-1;e=e+1}b=itemStartX+half_tile_width*d-half_tile_width*e;c=tile_height_offset+tile_height_offset*d+tile_height_offset*e;return Array(b,c)}function loc2pos_absolute(a){var b,c;var d,e;e=parseInt(a/map_arr_width);d=a%map_arr_width;b=half_bg_width+half_tile_width*d-half_tile_width*e;c=tile_height_offset+tile_height_offset*d+tile_height_offset*e;return Array(b,c)}function is_terrain_passable(a){for(var b=0;b<map_mark.length;b++){if(a==map_mark[b])return true}return false}function Hash(){this.length=0;this.items=new Array;for(var a=0;a<arguments.length;a+=2){if(typeof arguments[a+1]!="undefined"){this.items[arguments[a]]=arguments[a+1];this.length++}}this.removeItem=function(a){var b;if(typeof this.items[a]!="undefined"){this.length--;var b=this.items[a];delete this.items[a]}return b};this.getItem=function(a){return this.items[a]};this.setItem=function(a,b){var c;if(typeof b!="undefined"){if(typeof this.items[a]=="undefined"){this.length++}else{c=this.items[a]}this.items[a]=b}return c};this.hasItem=function(a){return typeof this.items[a]!="undefined"};this.clear=function(){for(var a in this.items){delete this.items[a]}this.length=0};this.getLength=function(){return this.length}}function createTwoDimensionArray(a,b){var c=new Array(a);for(var d=0;d<a;d++){c[d]=new Array(b)}return c}function in_obj_array(a,b){for(key in b){if(b[key].pos==a)return true}return false}function spriteMoveProcess_ht5(a){var b=new Array;var c=parseInt(a.repeatPathCnt);var d=parseInt(a.anID);var e=a.path.toString();var f;b=e.split(",");var g=a.getPathCntVal();var h=b[g];var i=6;var j=2;if(h){thisPos=parseInt(b[g]);nextPos=parseInt(b[g+1]);if(nextPos==thisPos+map_arr_width-1){if(c<i){c++;a.pos=thisPos}else if(c>=i){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=6}else if(nextPos==thisPos-map_arr_width+1){if(c<i){c++;a.pos=thisPos}else if(c>=i){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=2}else if(nextPos==thisPos+1){if(c<j){c++;a.pos=thisPos}else if(c>=j){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=5}else if(nextPos==thisPos-1){if(c<j){c++;a.pos=thisPos}else if(c>=j){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=3}else if(nextPos==thisPos+map_arr_width){if(c<j){c++;a.pos=thisPos}else if(c>=j){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=7}else if(nextPos==thisPos-map_arr_width){if(c<j){c++;a.pos=thisPos}else if(c>=j){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=1}else if(nextPos==thisPos+map_arr_width+1){if(c<j){c++;a.pos=thisPos}else if(c>=j){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=8}else if(nextPos==thisPos-map_arr_width-1){if(c<j){c++;a.pos=thisPos}else if(c>=j){c=0;a.pos=nextPos;g++}a.repeatPathCnt=c;a.dir=0}a.pathCnt=g;d++;if(d>paceNum){d=0}if(g+1>=b.length){d=0}a.anID=d}else{}return a}function spriteMoveProcess(a){var b=new Array;var c=parseInt(a.attr("spriteID"));var d=parseInt(a.attr("spriteHeight"));var e=parseInt(a.attr("repeatPathCnt"));var f=a.attr("path").toString();var g=parseInt(a.attr("anID"));b=f.split(",");var h=parseInt(a.attr("pathCnt"));var i=b[h];var j=6;if(c<1e3){j=6}else if(c>=1e3&&c<2e3){j=2}else{j=4}if(i){thisPos=parseInt(b[h]);nextPos=parseInt(b[h+1]);if(nextPos==thisPos+map_arr_width-1){if(e<6){e++;a[0].pos=thisPos}else if(e>=6){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",6)}else if(nextPos==thisPos-map_arr_width+1){if(e<6){e++;a[0].pos=thisPos}else if(e>=6){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",2)}else if(nextPos==thisPos+1){if(e<2){e++;a[0].pos=thisPos}else if(e>=2){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",5)}else if(nextPos==thisPos-1){if(e<2){e++;a[0].pos=thisPos}else if(e>=2){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",3)}else if(nextPos==thisPos+map_arr_width){if(e<2){e++;a[0].pos=thisPos}else if(e>=2){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",7)}else if(nextPos==thisPos-map_arr_width){if(e<2){e++;a[0].pos=thisPos}else if(e>=2){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",1)}else if(nextPos==thisPos+map_arr_width+1){if(e<2){e++;a[0].pos=thisPos}else if(e>=2){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",8)}else if(nextPos==thisPos-map_arr_width-1){if(e<2){e++;a[0].pos=thisPos}else if(e>=2){e=0;a[0].pos=nextPos;h++}a.attr("repeatPathCnt",e);a.attr("direction",0)}var k=loc2pos(parseInt(a[0].pos));var l=parseInt(a.attr("direction"));if(l==6){posX=k[0]-e*8;posY=k[1]-d}else if(l==2){posX=k[0]+e*8;posY=k[1]-d}else if(l==5){posX=k[0]+e*8;posY=k[1]-d+e*4}else if(l==3){posX=k[0]-e*8;posY=k[1]-d-e*4}else if(l==1){posX=k[0]+e*8;posY=k[1]-d-e*4}else if(l==7){posX=k[0]-e*8;posY=k[1]-d+e*4}else if(l==0){posX=k[0];posY=k[1]-d-e*8}else if(l==8){posX=k[0];posY=k[1]-d+e*8}else{posX=k[0];posY=k[1]-d;l=1}a.css("left",posX);posY=posY-screen_height_offset;a.css("top",posY);a.attr("pathCnt",h);var m=imgByDir(c,l);g++;if(g>j){g=0}if(h+1>=b.length){g=0}a.attr("src","res/spriteRes/"+c+"/"+m+"_"+g+".png");a.attr("anID",g)}return a}function spriteDir(a,b){a=parseInt(a);b=parseInt(b);var c=-1;if(b==a+1){c=5}else if(b==a-1){c=3}else if(b==a+map_arr_width){c=7}else if(b==a-map_arr_width){c=1}else if(b==a+map_arr_width+1){c=8}else if(b==a+map_arr_width-1){c=6}else if(b==a-map_arr_width+1){c=2}else if(b==a-map_arr_width-1){c=0}return c}function imgByDir(a,b){var c=a+"_10";if(b==0){c=a+"_11"}else if(b==1){c=a+"_10"}else if(b==2){c=a+"_10"}else if(b==3){c=a+"_11"}else if(b==5){c=a+"_12"}else if(b==6){c=a+"_13"}else if(b==7){c=a+"_13"}else if(b==8){c=a+"_12"}else{c=a+"_10"}return c}function imgByDir_cha(a,b){if(b==0){imgHead="lu"}else if(b==1){imgHead="ru"}else if(b==2){imgHead="ru"}else if(b==3){imgHead="lu"}else if(b==5){imgHead="rd"}else if(b==6){imgHead="ld"}else if(b==7){imgHead="ld"}else if(b==8){imgHead="rd"}else{imgHead="ru"}return imgHead}function htmlPosStrToNumber(a){return parseInt(a.substring(0,a.length-2))}function getNameLable(a,b){var c;if($("#"+a)[0])c=$("#"+a)[0];else{var c=document.createElement("DIV");c.setAttribute("id",a);c.setAttribute("align","center");c.style.position="absolute";c.style.width="135px";c.style.zIndex=99;c.style.fontSize="20px";if(a==user)c.innerHTML=getNameLableStyle_main(b);else c.innerHTML=getNameLableStyle(b)}return c}function getNameLableStyle(a){return"<br><div align='center' style='background: white;width:70px;z-index:10;font-size:18px'><b>"+a+"</b></div>"}function getNameLableStyle_main(a){return"<br><div align='center' style='width:20px;z-index:10;font-size:18px'><img src='./res/icons/pos.png'></div>"}function getChatBubbleStyle(a){return"<p class='triangle-isosceles'>"+a+"</p>"}function update_la_content(a,b,c){var d=getNameLable(a,c);if(b==""){if(a==user)d.innerHTML=getNameLableStyle_main(c);else d.innerHTML=getNameLableStyle(c)}else{d.innerHTML=getChatBubbleStyle(b)+d.innerHTML;chatmsg="&nbsp<font color='blue'>"+c+":</font>"+b+"<br>"+chatmsg;$("lay").html(chatmsg)}}function removePlayerLable(a){var b=$("#"+a);b.remove()}function showPlayerLable(a){var b=$("#"+a);b.css("display","")}function hidePlayerLable(a){var b=$("#"+a);b.css("display","none")}function isBGImg(a){if(a==1||a==2){return true}return false}function isTerrainImg(a){if(a.indexOf("/10.png")!=-1&&hideBg==1)return true;return false}function getItemOffset(a){var b=a.toString().split("_");if(map_offset[a]){if(b.length>1){var c=b[0];var d=b[1];if(parseInt(d)==0)return map_offset[a];else return 0}else{return map_offset[a]}}else{return 0}}function point(a,b,c,d,e,f,g){var h=document.createElement("img");h.setAttribute("type","pointImg");h.src=f;h.id=g;h.style.position="absolute";h.style.left=a+"px";h.style.top=b+"px";h.style.width=c+"px";h.style.height=d+"px";h.style.zIndex=e;$("#lay0").append(h)}function createRect(a,b,c,d,e){clearRect();point(a,b,c-a,1,9999,"point.jpg","l1");point(c,b,1,d-b,9999,"point.jpg","l2");point(a,b,1,d-b,9999,"point.jpg","l3");point(a,d,c-a,1,9999,"point.jpg","l4")}function clearRect(){var a=$("IMG[type='pointImg']");for(var b=0;b<a.length;b++){var c=$("#"+a[b].id);c.remove()}}function setToOrder(a){a.sort(function(a,b){var c=loc2pos_absolute(a)[0];var d=loc2pos_absolute(b)[0];return c-d});return a}function setHashOrder(a){a.sort(function(a,b){var c=a.getPos();var d=b.getPos();return c-d});return a}function debugMsg(a){$("#debuginfo").val(a)}function uuidlet(){return((1+Math.random())*65536|0).toString(16).substring(1)}function getuuid(a){uuid_default_prefix=a;a=a||uuid_default_prefix||"";return a+uuidlet()+uuidlet()+"-"+uuidlet()+"-"+uuidlet()+"-"+uuidlet()+"-"+uuidlet()+uuidlet()+uuidlet()}function in_array(a,b){for(var c=0;c<b.length;c++){if(b[c]==a)return false}return true}function setProgress(val){eval('$( "#progressbar" ).progressbar({value:'+val+"})")}function isloaded(){if(version==2){$("#layLoading").remove()}else{var a=roomRes.loadedRec.getItem(main_img_id).loaded;var b=roomRes.mapResHash.getLength();if(b==itemNum&&a==spriteNum){$("#layLoading").remove();$("#lay0").css("display","");$("#startDiv").css("display","")}}}function getTransformProperty(a){var b=["transform","WebkitTransform","MozTransform","msTransform","OTransform"];var c;while(c=b.shift()){if(typeof a.style[c]!="undefined"){return c}}return false}function isActContent(a){if(a.startWith("&&"))return true;else if(unescape(a).startWith("&&"))return true;return false}function isClothContent(a){if(a.startWith(">>"))return true;else if(unescape(a).startWith(">>"))return true;return false}function getWidth(){xWidth=null;if(window.screen!=null)xWidth=window.screen.width;if(window.innerWidth!=null)xWidth=window.innerWidth;if(document.body!=null)xWidth=document.body.clientWidth;return xWidth}function getHeight(){xHeight=null;if(window.screen!=null)xHeight=window.screen.height;if(window.innerHeight!=null)xHeight=window.innerHeight;if(document.body!=null)xHeight=document.body.clientHeight;return xHeight}String.prototype.startWith=function(a){var b=new RegExp("^"+a);return b.test(this)};String.prototype.startWith=function(a){var b=new RegExp("^"+a);return b.test(this)};String.prototype.replaceAll=function(a,b){var c=new RegExp(a.replace(/([\(\)\[\]\{\}\^\$\+\-\*\?\.\"\'\|\/\\])/g,"\\$1"),"ig");return this.replace(c,b)}